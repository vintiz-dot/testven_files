<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0" />
  <title>Mercury Class Assessment</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    rel="stylesheet" />
  <link
    href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap"
    rel="stylesheet" />
  <style>
    :root {
      --glass-bg: rgba(255, 255, 255, 0.1);
      --glass-border: rgba(255, 255, 255, 0.2);
      --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      --tint: #0a84ff;
      --ok: #34c759;
    }

    body {
      font-family: "Poppins", sans-serif;
      background: linear-gradient(45deg, #4f46e5, #0f172a, #db2777);
      background-size: 400% 400%;
      animation: gradientBG 15s ease infinite;
      min-height: 100vh;
      color: white;
      overflow-x: hidden;
    }

    @keyframes gradientBG {
      0% {
        background-position: 0% 50%;
      }
      50% {
        background-position: 100% 50%;
      }
      100% {
        background-position: 0% 50%;
      }
    }

    .glass-panel {
      background: var(--glass-bg);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
      border: 1px solid var(--glass-border);
      box-shadow: var(--glass-shadow);
      border-radius: 24px;
      transition: all 0.3s ease;
    }

    .liquid-input {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(4px);
      color: white;
      transition: all 0.3s ease;
    }

    .liquid-input:focus {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(255, 255, 255, 0.5);
      outline: none;
      box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
    }

    .luxury-btn {
      background: linear-gradient(
        135deg,
        rgba(255, 255, 255, 0.1),
        rgba(255, 255, 255, 0)
      );
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      cursor: pointer;
    }

    .luxury-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(
        90deg,
        transparent,
        rgba(255, 255, 255, 0.2),
        transparent
      );
      transition: 0.5s;
    }

    .luxury-btn:hover::before {
      left: 100%;
    }

    .luxury-btn:hover {
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.4);
      box-shadow: 0 10px 40px 0 rgba(0, 0, 0, 0.4);
    }

    .option-card {
      cursor: pointer;
      transition: all 0.2s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      background: rgba(255, 255, 255, 0.05);
    }
    .option-card:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: scale(1.01);
    }
    .option-card.selected {
      background: rgba(255, 255, 255, 0.2);
      border-color: #34c759;
      box-shadow: 0 0 15px rgba(52, 199, 89, 0.3);
    }

    .floating-orb {
      position: absolute;
      border-radius: 50%;
      filter: blur(80px);
      z-index: -1;
      animation: float 10s infinite;
    }

    @keyframes float {
      0% {
        transform: translate(0, 0);
      }
      50% {
        transform: translate(20px, 20px);
      }
      100% {
        transform: translate(0, 0);
      }
    }

    .fade-in {
      animation: fadeIn 0.6s ease-out forwards;
      opacity: 0;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .title-font {
      font-family: "Playfair Display", serif;
    }

    /* Specific Styles for Comparison Questions */
    .comparison-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      font-size: 1.5rem;
      font-weight: bold;
    }
    .number-display {
      font-family: "Poppins", monospace;
      font-size: 1.8rem;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
    }
  </style>
</head>
<body class="flex items-center justify-center p-4">
  <div class="floating-orb w-64 h-64 bg-purple-600 opacity-40 top-10 left-10"></div>
  <div class="floating-orb w-96 h-96 bg-blue-600 opacity-30 bottom-10 right-10"></div>

  <div
    id="app-container"
    class="w-full max-w-3xl glass-panel p-8 md:p-12 relative overflow-hidden min-h-[600px] flex flex-col">
    <!-- Header -->
    <div
      class="flex flex-wrap justify-between items-center border-b border-white/10 pb-6 mb-8 text-sm md:text-base">
      <div class="flex items-center space-x-4">
        <div
          class="w-10 h-10 rounded-full bg-white/10 flex items-center justify-center">
          <i class="fas fa-school text-pink-300"></i>
        </div>
        <div>
          <p class="text-white/60 text-xs uppercase tracking-wider">School</p>
          <p class="font-semibold">Happy English Club</p>
        </div>
      </div>
      <div class="flex items-center space-x-4 mt-4 md:mt-0">
        <div class="text-right">
          <p class="text-white/60 text-xs uppercase tracking-wider">Teacher</p>
          <p class="font-semibold">Victor</p>
        </div>
        <div class="h-8 w-px bg-white/20 mx-2"></div>
        <div>
          <p class="text-white/60 text-xs uppercase tracking-wider">Class</p>
          <p class="font-semibold text-blue-300">Mercury</p>
        </div>
      </div>
    </div>

    <!-- View: Login -->
    <div
      id="view-login"
      class="flex-1 flex flex-col justify-center items-center text-center fade-in">
      <h1
        class="title-font text-4xl md:text-5xl font-bold mb-4 bg-clip-text text-transparent bg-gradient-to-r from-white to-blue-200">
        Mercury Math Assessment
      </h1>
      <p class="text-lg text-white/80 mb-10 max-w-md">
        Comparing Five-Digit Numbers &amp; Adaptive Real-World Context
      </p>
      <div class="w-full max-w-md space-y-6">
        <div class="relative group">
          <i
            class="fas fa-user absolute left-4 top-1/2 transform -translate-y-1/2 text-white/50 group-focus-within:text-white transition-colors"></i>
          <input
            type="text"
            id="student-name"
            placeholder="Enter your full name"
            class="liquid-input w-full py-4 pl-12 pr-6 rounded-xl text-lg placeholder-white/30" />
        </div>
        <button
          onclick="startTest()"
          class="luxury-btn w-full py-4 rounded-xl font-semibold text-lg tracking-wide hover:bg-white/5">
          Begin Assessment <i class="fas fa-arrow-right ml-2"></i>
        </button>
      </div>
    </div>

    <!-- View: Test -->
    <div id="view-test" class="hidden flex-col flex-1 fade-in">
      <div class="w-full bg-white/5 rounded-full h-1.5 mb-8">
        <div
          id="progress-bar"
          class="bg-gradient-to-r from-pink-500 to-blue-500 h-1.5 rounded-full w-0 transition-all duration-500"></div>
      </div>

      <div
        id="question-container"
        class="flex-1 flex flex-col justify-center min-h-[300px]">
        <!-- Injected via JS -->
      </div>

      <div class="flex justify-between mt-8 pt-6 border-t border-white/10">
        <button
          id="prev-btn"
          onclick="nav(-1)"
          class="luxury-btn px-6 py-2 rounded-lg opacity-50 text-sm">
          Back
        </button>
        <button
          id="next-btn"
          onclick="nav(1)"
          class="luxury-btn px-8 py-3 rounded-xl font-semibold bg-white/10">
          Next Question
        </button>
      </div>
    </div>

    <!-- View: Intermission (Gemini Loading) -->
    <div
      id="view-loading"
      class="hidden flex-1 flex-col justify-center items-center text-center fade-in">
      <div
        class="w-20 h-20 border-4 border-white/10 border-t-pink-500 rounded-full animate-spin mb-6"></div>
      <h2 class="title-font text-2xl font-bold">Grading &amp; Generating...</h2>
      <p class="text-white/60 mt-2 max-w-sm">
        Teacher Victor is creating 5 bonus questions just for you ðŸ˜ŠðŸ˜Š.
      </p>
    </div>

    <!-- View: Result -->
    <div
      id="view-result"
      class="hidden flex-1 flex-col justify-center items-center text-center fade-in">
      <div
        class="w-24 h-24 bg-gradient-to-tr from-green-400 to-blue-500 rounded-full flex items-center justify-center mb-6 shadow-lg shadow-blue-500/30">
        <i class="fas fa-check text-4xl text-white"></i>
      </div>
      <h2 class="title-font text-4xl font-bold mb-2">Assessment Complete</h2>
      <p class="text-white/70 mb-8">
        Excellent work, <span id="final-name" class="font-semibold text-white"></span
        >!
      </p>

      <div class="glass-panel p-6 mb-8 w-full max-w-sm mx-auto bg-white/5">
        <p class="text-sm uppercase tracking-widest text-white/50 mb-2">
          Final Score
        </p>
        <div
          class="text-5xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-pink-300 to-blue-300">
          <span id="final-percent">0</span>%
        </div>
        <p class="text-sm mt-2 text-white/60">
          Base: <span id="score-base">0/0</span> | Adaptive:
          <span id="score-adaptive">0/0</span>
        </p>
      </div>
      <p id="upload-status" class="text-sm text-white/40 mb-6">
        <i class="fas fa-sync fa-spin mr-2"></i>Uploading to Google Sheet...
      </p>
    </div>
  </div>

  <!-- Hidden form for iframe submission -->
  <div style="display: none">
    <iframe name="hidden_iframe" id="hidden_iframe" style="display: none"></iframe>
    <form
      id="google-form"
      action="https://docs.google.com/forms/d/e/1FAIpQLSeVstxYs3B_SzhOsk-Lxe96ilZdPOokT2qiE0ucDQlNBB4sGg/formResponse"
      method="post"
      target="hidden_iframe">
      <input type="text" name="entry.1714798495" id="form-name" />
      <input type="text" name="entry.1036145399" id="form-json" />
      <input type="hidden" name="fvv" value="1" />
      <input type="hidden" name="draftResponse" value="[]" />
      <input type="hidden" name="pageHistory" value="0" />
    </form>
  </div>

  <script>
    // --- CONFIGURATION ---
    const apiKey = "AIzaSyA5ZyPkFXdp_50oEdNrJyW-mD6T12BnD1s"; // Optional for adaptive phase. Leave blank to skip.

    // --- RAW QUESTION DATA ---
    const rawData = {
      P1: [
        ["10,525", "10,255", ">"],
        ["32,323", "23,232", ">"],
        ["13,003", "31,001", "<"],
        ["57,775", "75,557", "<"],
        ["65,065", "65,065", "="],
        ["11,954", "11,459", ">"],
        ["73,002", "7,477", ">"],
        ["14,010", "14,001", ">"],
        ["50,020", "50,020", "="],
        ["49,919", "94,491", "<"],
        ["80,404", "80,044", ">"],
        ["$61,611", "$61,116", ">"],
      ],
      P2: [
        ["36,433", "64,333", "B"],
        ["82,202", "8,999", "A"],
        ["57,117", "71,571", "B"],
      ],
      P3: [
        ["49,940", "40,904", "B"],
        ["18,818", "18,188", "B"],
        ["10,010", "10,001", "B"],
      ],
      P4: [
        ["22,212", "22,221", "is less than"],
        ["40,098", "40,098", "is equal to"],
        ["66,980", "66,089", "is greater than"],
        ["72,234", "73,224", "is less than"],
        ["$5,888", "$30,003", "is less than"],
      ],
      P5: [
        [
          "Every month in summer, Hyde Park had 10,705 picnickers in June and 10,075 in July. Which month had more?",
          ["June", "July"],
          "June",
        ],
        [
          "Mr. Wallace sold 21,101 hot dogs in his first season and 20,111 in his second. Which season had more sales?",
          ["First", "Second"],
          "First",
        ],
      ],
    };

    // --- STATE ---
    let studentName = "";
    let allQuestions = [];
    let currentIndex = 0;
    let answers = [];
    let adaptiveTriggered = false;

    // --- INIT ---
    function init() {
      // P1 compare
      rawData.P1.forEach((q) =>
        allQuestions.push({
          type: "compare",
          part: "Part 1",
          text: "Compare the numbers",
          a: q[0],
          b: q[1],
          correct: q[2].replace("&lt;", "<").replace("&gt;", ">"),
        })
      );
      // P2 greater
      rawData.P2.forEach((q) =>
        allQuestions.push({
          type: "binary",
          part: "Part 2",
          text: "Select the GREATER amount",
          a: q[0],
          b: q[1],
          correct: q[2],
          valA: "A",
          valB: "B",
        })
      );
      // P3 smaller
      rawData.P3.forEach((q) =>
        allQuestions.push({
          type: "binary",
          part: "Part 3",
          text: "Select the SMALLER amount",
          a: q[0],
          b: q[1],
          correct: q[2],
          valA: "A",
          valB: "B",
        })
      );
      // P4 words
      rawData.P4.forEach((q) =>
        allQuestions.push({
          type: "words",
          part: "Part 4",
          text: "Choose the correct phrase",
          a: q[0],
          b: q[1],
          correct: q[2].toLowerCase(),
          options: ["is greater than", "is less than", "is equal to"],
        })
      );
      // P5 stories
      rawData.P5.forEach((q) =>
        allQuestions.push({
          type: "story",
          part: "Part 5",
          text: q[0],
          options: q[1],
          correct: q[2],
        })
      );

      answers = new Array(allQuestions.length).fill(null);
    }
    init();

    function startTest() {
      const inp = document.getElementById("student-name");
      if (!inp.value.trim()) {
        inp.focus();
        return;
      }
      studentName = inp.value.trim();

      document.getElementById("view-login").classList.add("hidden");
      document.getElementById("view-test").classList.remove("hidden");
      document.getElementById("view-test").classList.add("flex");
      renderQuestion();
    }

    function renderQuestion() {
      const q = allQuestions[currentIndex];
      const container = document.getElementById("question-container");
      const currentAns = answers[currentIndex];

      // Progress
      const pct = (currentIndex / allQuestions.length) * 100;
      document.getElementById("progress-bar").style.width = `${pct}%`;

      // Template Logic
      let contentHTML = "";

      if (q.type === "compare") {
        contentHTML = `
          <div class="comparison-wrapper mb-8">
            <span class="number-display">${q.a}</span>
            <div class="flex gap-2">
              ${["<", ">", "="]
                .map(
                  (op) => `
                <button onclick="selectOption('${op}')" class="option-card w-12 h-12 rounded-lg text-xl font-bold flex items-center justify-center ${
                  currentAns === op ? "selected" : ""
                }">${op
                  .replace("<", "&lt;")
                  .replace(">", "&gt;")}</button>
              `
                )
                .join("")}
            </div>
            <span class="number-display">${q.b}</span>
          </div>
        `;
      } else if (q.type === "binary") {
        contentHTML = `
          <div class="flex flex-col md:flex-row gap-4 justify-center items-center mb-6">
            <button onclick="selectOption('A')" class="option-card w-full md:w-48 py-6 rounded-xl text-2xl font-mono ${
              currentAns === "A" ? "selected" : ""
            }">${q.a}</button>
            <span class="text-white/30">vs</span>
            <button onclick="selectOption('B')" class="option-card w-full md:w-48 py-6 rounded-xl text-2xl font-mono ${
              currentAns === "B" ? "selected" : ""
            }">${q.b}</button>
          </div>
        `;
      } else if (q.type === "words") {
        contentHTML = `
          <div class="text-center mb-6">
            <div class="flex justify-center items-center gap-4 mb-4">
              <span class="text-2xl font-mono">${q.a}</span>
              <span class="text-white/50">___</span>
              <span class="text-2xl font-mono">${q.b}</span>
            </div>
            <div class="grid gap-3 max-w-md mx-auto">
              ${q.options
                .map(
                  (opt) => `
                <button onclick="selectOption('${opt}')" class="option-card py-3 px-4 rounded-lg text-lg ${
                  currentAns === opt ? "selected" : ""
                }">${opt}</button>
              `
                )
                .join("")}
            </div>
          </div>
        `;
      } else if (q.type === "story" || q.type === "adaptive") {
        contentHTML = `
          <div class="bg-white/5 p-6 rounded-xl mb-6 border border-white/10">
            <p class="text-lg leading-relaxed">${q.text}</p>
          </div>
          <div class="grid gap-3 max-w-md mx-auto">
            ${q.options
              .map(
                (opt) => `
              <button onclick="selectOption('${opt}')" class="option-card py-3 px-4 rounded-lg text-lg ${
                currentAns === opt ? "selected" : ""
              }">${opt}</button>
            `
              )
              .join("")}
          </div>
        `;
      }

      container.innerHTML = `
        <div class="fade-in w-full">
          <div class="mb-2 flex justify-between items-end">
            <span class="text-pink-300 text-xs font-bold tracking-widest uppercase">${
              q.part || "Bonus"
            }</span>
            <span class="text-white/40 text-xs">Q${currentIndex + 1} of ${
        allQuestions.length
      }</span>
          </div>
          <h2 class="title-font text-2xl md:text-3xl font-bold mb-8">${
            q.text
          }</h2>
          ${contentHTML}
        </div>
      `;

      // Button Logic
      const prevBtn = document.getElementById("prev-btn");
      const nextBtn = document.getElementById("next-btn");

      prevBtn.disabled = currentIndex === 0;
      prevBtn.style.opacity = currentIndex === 0 ? "0" : "1";

      if (currentIndex === allQuestions.length - 1) {
        nextBtn.innerText = adaptiveTriggered ? "Finish & Submit" : "Continue";
        nextBtn.classList.add("bg-pink-500/20");
      } else {
        nextBtn.innerText = "Next Question";
        nextBtn.classList.remove("bg-pink-500/20");
      }
    }

    function selectOption(val) {
      answers[currentIndex] = val;
      renderQuestion(); // re-render to show selection state
    }

    function nav(dir) {
      // Require an answer to move forward
      if (dir === 1 && !answers[currentIndex]) {
        return;
      }

      const nextIndex = currentIndex + dir;

      if (nextIndex >= allQuestions.length) {
        if (!adaptiveTriggered) {
          triggerAdaptivePhase();
        } else {
          finishTest();
        }
      } else {
        currentIndex = nextIndex;
        renderQuestion();
      }
    }

    // --- ADAPTIVE PHASE (optional: uses Gemini if apiKey provided) ---
    async function triggerAdaptivePhase() {
      // 1. Grade current performance
      let score = 0;
      let staticCount = 0;
      allQuestions.forEach((q, i) => {
        if (q.type !== "adaptive") {
          staticCount++;
          if (q.type === "words") {
            if (answers[i] && answers[i].toLowerCase() === q.correct) score++;
          } else {
            if (answers[i] === q.correct) score++;
          }
        }
      });
      const pct = (score / staticCount) * 100;

      // 2. Loading screen
      document.getElementById("view-test").classList.add("hidden");
      document.getElementById("view-test").classList.remove("flex");
      document.getElementById("view-loading").classList.remove("hidden");
      document.getElementById("view-loading").classList.add("flex");

      // 3. Build prompt
      let difficulty = "standard";
      let feedback = "";
      if (pct > 80) {
        difficulty = "challenging";
        feedback =
          "Student is doing great. Make questions slightly harder but keep English extremely simple.";
      } else if (pct < 50) {
        difficulty = "very easy";
        feedback =
          "Student is struggling. Make questions very easy.";
      } else {
        difficulty = "moderate";
        feedback =
          "Student is average. Keep questions standard.";
      }

      // MODIFIED PROMPT FOR ESL / GRADE 1 READING LEVEL
      const prompt = `Generate 5 very simple math word problems for Grade 3 ESL students who read at a Grade 1 level.
Math Topic: Comparing 5-digit numbers (e.g., 12,000 vs 15,000).
Difficulty: ${difficulty}. ${feedback}
Writing Style: Use extremely simple English. Short sentences. Basic vocabulary (like "apple", "car", "score", "price"). No complex grammar.
Themes: Video game scores, buying toys, number of candies, school items.
Format: JSON array of objects with keys: "question", "options" (array of 2-3 choices), "correct" (string matching one option).`;

      try {
        if (!apiKey) throw new Error("No API key");
        const response = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
          {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
              contents: [{ parts: [{ text: prompt }] }],
              generationConfig: { responseMimeType: "application/json" },
            }),
          }
        );
        const data = await response.json();
        const newQuestions = JSON.parse(
          data.candidates[0].content.parts[0].text
        );

        newQuestions.forEach((nq) => {
          allQuestions.push({
            type: "adaptive",
            part: "Bonus Round",
            text: nq.question,
            options: nq.options,
            correct: nq.correct,
          });
          answers.push(null);
        });

        adaptiveTriggered = true;
        currentIndex++; // start at first adaptive item

        document.getElementById("view-loading").classList.add("hidden");
        document.getElementById("view-loading").classList.remove("flex");
        document.getElementById("view-test").classList.remove("hidden");
        document.getElementById("view-test").classList.add("flex");
        renderQuestion();
      } catch (e) {
        // If API fails or not configured, just finish
        finishTest();
      }
    }

    // ====== SUBMIT TO GOOGLE FORMS (robust iframe method) ======
    function submitToGoogleForm(student, payload) {
      const form = document.getElementById("google-form");
      const iframe = document.getElementById("hidden_iframe");
      const status = document.getElementById("upload-status");
      const nameField = document.getElementById("form-name");
      const jsonField = document.getElementById("form-json");

      // Fill fields
      nameField.value = student || "";
      // keep payload compact
      const json = JSON.stringify(payload, (k, v) => (v === "" ? undefined : v));
      jsonField.value = json.length > 12000 ? json.slice(0, 11997) + "..." : json;

      // Visual state
      status.innerHTML =
        '<i class="fas fa-sync fa-spin mr-2"></i>Uploading to Google Sheet...';

      // Success handler (fires after the form posts and the response page loads)
      const onLoad = () => {
        status.innerHTML =
          '<i class="fas fa-check text-green-400 mr-2"></i>Uploaded to Google Sheet';
        iframe.removeEventListener("load", onLoad);
      };

      // Attach one-time load handler
      iframe.addEventListener("load", onLoad, { once: true });

      // Fallback timeout in case some browsers don't fire load reliably
      setTimeout(() => {
        // if still showing spinner, mark as submitted anyway
        if (status.innerHTML.includes("fa-sync")) {
          status.innerHTML =
            '<i class="fas fa-check text-green-400 mr-2"></i>Submitted (awaiting Sheet sync)';
        }
      }, 8000);

      // Submit (CSP-safe POST)
      form.submit();
    }

    function finishTest() {
      // Hide test, show result
      document.getElementById("view-test").classList.add("hidden");
      document.getElementById("view-test").classList.remove("flex");
      document.getElementById("view-result").classList.remove("hidden");
      document.getElementById("view-result").classList.add("flex");

      // Calculate scores
      let baseScore = 0,
        baseTotal = 0;
      let adaptScore = 0,
        adaptTotal = 0;

      allQuestions.forEach((q, i) => {
        let isCorrect = false;
        if (q.type === "words") {
          isCorrect = answers[i] && answers[i].toLowerCase() === q.correct;
        } else {
          isCorrect = answers[i] === q.correct;
        }

        if (q.type === "adaptive") {
          adaptTotal++;
          if (isCorrect) adaptScore++;
        } else {
          baseTotal++;
          if (isCorrect) baseScore++;
        }
      });

      const totalScore = baseScore + adaptScore;
      const totalMax = baseTotal + adaptTotal;
      const finalPct = Math.round((totalScore / (totalMax || 1)) * 100);

      // Display
      document.getElementById("final-name").innerText = studentName;
      document.getElementById("final-percent").innerText = finalPct;
      document.getElementById("score-base").innerText = `${baseScore}/${baseTotal}`;
      document.getElementById("score-adaptive").innerText = `${adaptScore}/${adaptTotal}`;

      // Build payload
      const payload = {
        meta: {
          student: studentName,
          klass: "Mercury",
          teacher: "Victor",
          school: "Happy English Club",
          timestamp: new Date().toISOString(),
        },
        score: {
          total: totalScore,
          max: totalMax,
          percent: finalPct,
          breakdown: {
            base: `${baseScore}/${baseTotal}`,
            adaptive: `${adaptScore}/${adaptTotal}`,
          },
        },
      };

      // Submit to Google Form -> linked Google Sheet
      submitToGoogleForm(studentName, payload);
    }
  </script>
</body>
</html>